<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Checkout | WoodCraft Doors</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: Segoe UI, sans-serif;
  background: url('https://images.unsplash.com/photo-1600585154340-be6161a56a0c') center/cover no-repeat fixed;
  background-size: cover;
  color: white;
  min-height: 100vh;
}

/* NAVBAR */
.navbar {
  background: rgba(0,0,0,0.45);
  backdrop-filter: blur(12px);
  border-radius: 40px;
  margin: 10px 20px;
  padding: 6px 18px;
  box-shadow: 0 4px 14px rgba(0,0,0,.25);
}
.navbar .nav-link {
  color: #fff !important;
  font-weight: 600;
}
.navbar .nav-link:hover,
.navbar .nav-link.active {
  color: #ffc107 !important;
}

/* CHECKOUT CARD */
.checkout-box {
  background: rgba(0,0,0,0.65);
  backdrop-filter: blur(10px);
  border-radius: 18px;
  padding: 30px;
  box-shadow: 0 10px 30px rgba(0,0,0,.4);
}

/* ORDER SUMMARY */
#order-summary .item {
  display: flex;
  justify-content: space-between;
  padding: 6px 0;
  border-bottom: 1px solid rgba(255,255,255,0.2);
}
#order-summary .item:last-child { border-bottom: none; }

/* FOOTER */
footer {
  background: #111;
  color: #ddd;
}
footer h5 {
  color: #ffc107;
}
footer a {
  color: #ccc;
  text-decoration: none;
}
footer a:hover {
  color: #ffc107;
}
.footer-bottom {
  background: #000;
  text-align: center;
  padding: 12px;
  font-size: 0.9rem;
}

/* CART BADGE */
.navbar .badge {
  position: absolute;
  top: -10px;
  right: -5px;
  font-size: 0.7rem;
  padding: 2px 6px;
}

/* MEDIA */
@media(max-width:768px){
  .checkout-box { padding: 20px; }
  .navbar-brand img { height: 55px; }
}
</style>
</head>

<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg fixed-top">
<div class="container-fluid">
  <a class="navbar-brand" href="index.html">
    <img src="sakwoodLOGO.png" alt="WoodCraft Logo" style="height:65px;">
  </a>

  <button class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbarNav">
    <span class="navbar-toggler-icon" style="filter:invert(1)"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav ms-auto align-items-lg-center">
      <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
      <li class="nav-item"><a class="nav-link" href="products.html">Products</a></li>
      <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
      <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
      <li class="nav-item"><a class="nav-link" href="faq.html">FAQ</a></li>
      <li class="nav-item ms-lg-3">
        <a class="nav-link position-relative" href="cart.html">
          üõí <span id="cart-count" class="badge bg-danger">0</span>
        </a>
      </li>
    </ul>
  </div>
</div>
</nav>

<!-- CHECKOUT -->
<div class="container" style="margin-top:130px; margin-bottom:80px;">
  <div class="row justify-content-center">
    <div class="col-md-8 checkout-box">
      <h3 class="mb-4 text-warning">Checkout ‚Äì Payment on Delivery</h3>

      <form id="checkoutForm">
        <div class="row">
          <div class="col-md-6 mb-3">
            <label>Full Name</label>
            <input type="text" class="form-control" required>
          </div>
          <div class="col-md-6 mb-3">
            <label>Phone Number</label>
            <input type="tel" class="form-control" required>
          </div>
        </div>

        <div class="mb-3">
          <label>Email (optional)</label>
          <input type="email" class="form-control">
        </div>

        <div class="mb-3">
          <label>Delivery Address</label>
          <textarea class="form-control" rows="3" required></textarea>
        </div>

        <hr class="text-light">

        <h5 class="text-warning">Order Summary</h5>
        <div id="order-summary" class="mb-3"></div>

        <h6 class="mb-4">Payment Method: <strong>Payment on Delivery</strong></h6>

        <button type="submit" class="btn btn-warning w-100 btn-lg">
          Place Order
        </button>
      </form>
    </div>
  </div>
</div>

<!-- FOOTER -->
<footer>
  <div class="container py-4">
    <div class="row">
      <div class="col-md-4">
        <h5>SakwoodEnterprise Doors</h5>
        <p>Premium wooden doors crafted for durability, security and beauty.</p>
      </div>
      <div class="col-md-4">
        <h5>Contact</h5>
        <p>üìç Sasabi Junction, Dodowa Road</p>
        <p>üìû 0243860943 / 0552186664</p>
        <p>üìß <a href="mailto:sakwoodenterprise@gmail.com">sakwoodenterprise@gmail.com</a></p>
      </div>
      <div class="col-md-4">
        <h5>Quick Links</h5>
        <p><a href="index.html">Home</a></p>
        <p><a href="products.html">Products</a></p>
         <p><a href="about.html">About</a></p>
        <p><a href="contact.html">Contact</a></p>
        <p><a href="faq.html">FAQ</a></p>
      </div>
    </div>
  </div>

  <div class="footer-bottom">
    ¬© 2026 WoodCraft Doors. All Rights Reserved.
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// GLOBAL CART COUNT (USED ON ALL PAGES)
// ================= SYNC CART ACROSS PAGES =================
// ======= CART FUNCTIONS =======

// Get cart from localStorage
function getCart() {
  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  return cart.map(item => ({ ...item, qty: item.qty && item.qty > 0 ? Number(item.qty) : 0 }));
}

// Update cart badge
function updateCartBadge() {
  const cart = getCart();
  const count = cart.reduce((sum, item) => sum + item.qty, 0);
  const badge = document.getElementById("cart-count");
  if (badge) badge.textContent = count;
  togglePlaceOrderButton(count);
}

// Enable/disable "Place Order" button
function togglePlaceOrderButton(count) {
  const btn = document.querySelector("#checkoutForm button[type=submit]");
  if(btn) btn.disabled = count === 0;
}

// Display order summary
function displayOrderSummary() {
  const cart = getCart();
  const summaryDiv = document.getElementById("order-summary");
  summaryDiv.innerHTML = "";

  const hasItems = cart.some(i => i.qty > 0);

  if (!hasItems) {
    summaryDiv.innerHTML = "<p>Your cart is empty.</p>";
    return;
  }

  cart.forEach(item => {
    if(item.qty > 0){
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `<span>${item.name} x ${item.qty}</span> <strong>‚Çµ${item.price * item.qty}</strong>`;
      summaryDiv.appendChild(div);
    }
  });
}

// Handle checkout and send to SendGrid API
document.getElementById("checkoutForm").addEventListener("submit", async function(e){
  e.preventDefault();

  const cart = getCart().filter(i => i.qty > 0);
  if(cart.length === 0){
    alert("Your cart is empty!");
    return;
  }

  const customer = {
    name: this.querySelector("input[type=text]").value,
    phone: this.querySelector("input[type=tel]").value,
    email: this.querySelector("input[type=email]").value,
    address: this.querySelector("textarea").value
  };

  const total = cart.reduce((sum,i) => sum + (i.price * i.qty), 0);

  try {
    const res = await fetch("/api/send-order", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ customer, cart, total })
    });

    const data = await res.json();
    if(data.success){
      alert("Order placed successfully!");
      localStorage.removeItem("cart");
      updateCartBadge();
      displayOrderSummary();
      setTimeout(() => window.location.href = "index.html", 1000);
    } else {
      alert("Failed to send order. Please try again.");
    }
  } catch(err){
    console.error(err);
    alert("Error submitting order. Please try again.");
  }
});

// Initialize page
document.addEventListener("DOMContentLoaded", function(){
  updateCartBadge();
  displayOrderSummary();
});
</script>

</body>
</html>
